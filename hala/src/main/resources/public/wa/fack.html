<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Halachat Admin Website</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>

    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />

</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="assets/img/sidebar-5.jpg">

        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text">
                    Halachat
                </a>
            </div>

            <ul class="nav">
                <li >
                    <a href="dashboard.html">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li class="">
                    <a href="member.html">
                        <i class="pe-7s-user"></i>
                        <p>用户</p>
                    </a>
                </li>
                <li class="">
                    <a href="room.html">
                        <i class="pe-7s-key"></i>
                        <p>房间</p>
                    </a>
                </li>
                <li>
                    <a href="recharge.html">
                        <i class="pe-7s-cash"></i>
                        <p>充值</p>
                    </a>
                </li>
                <li>
                    <a href="feedback.html">
                        <i class="pe-7s-note"></i>
                        <p>反馈</p>
                    </a>
                </li>
                <li>
                    <a href="setting.html">
                        <i class="pe-7s-plugin"></i>
                        <p>通用设置</p>
                    </a>
                </li>

                <li>
                    <a href="report.html">
                        <i class="pe-7s-alarm"></i>
                        <p>举报</p>
                    </a>
                </li>
                <li>
                    <a href="dynamicReport.html">
                        <i class="pe-7s-car"></i>
                        <p>动态举报</p>
                    </a>
                </li>

                <li><a href="memberApproval.html">
                    <i class="pe-7s-album"></i>
                    <p>人员审批</p>
                </a>
                </li>

                <li><a href="roomApproval.html">
                    <i class="pe-7s-anchor"></i>
                    <p>房间审批</p>
                </a>
                </li>

                <li><a href="roomStyle.html">
                    <i class="pe-7s-airplay"></i>
                    <p>房间类型</p>
                </a>
                </li>
                <li> <a href="tag.html">
                    <i class="pe-7s-anchor"></i>
                    <p>标签管理</p>
                </a>
                </li>
                <li class="active"> <a href="fack.html">
                    <i class="pe-7s-bookmarks"></i>
                    <p>发布</p>
                </a>
                </li>

            </ul>
        </div>
    </div>

    <div class="main-panel">

        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="header"><h4  class="title">创建用户</h4></div>
                            <br>
                            <div>
                            <div class="col-md-2.8 pull-right">、
                            </div>
                                <form id="memberForm"  class="form-inline" style="margin: 8px;">
                                    <div style="display: inline; margin:15px ">
                                        昵称 <input name="nickname" class="form-control" type="text" style="width:120px;height: 25px">
                                    </div>
                                    <div style="display: inline; margin:15px ">
                                        性别 <select name="gender" >
                                                <option value="male">男</option>
                                                <option value="female">女</option>
                                            </select>
                                    </div>
                                    <div style="display: inline; margin:15px ">
                                        生日 <input name="dob" class="form-control" type="text" style="width:120px;height: 25px">
                                    </div>
                                    <div style="display: inline; margin:15px ">
                                        个人介绍 <input name="introduction" class="form-control" type="text" style="width:300px;height: 25px;">
                                    </div>
                                        <input name="avatarUrl" type="hidden" >
                                    <button  type="button" id="memberBtn" class="btn btn-primary btn-sm">确认</button>
                                </form>
                                <hr>
                            <div class="header"><h4  class="title">发布动态</h4></div>
                            <div id="upload-area" class="col-md-2.9 pull-right">
                                <select id="type"  class="btn btn-sm">
                                    <option value="avatar">头像</option>
                                    <option value="moment">动态</option>
                                </select>
                                <button class="btn btn-info btn-sm" id="upload-select">
                                    <i style="font-weight:bold;font-size: 15px"class="pe-7s-upload"></i>
                                </button>
                            </div>

                            <div class="content table-responsive table-full-width">
                                <form id="dynamicForm">

                                    <textarea type="text" name="content" style="margin-left: 20px;width: 1000px;height: 100px">
                                    </textarea>

                                    <input name="imgUrl" type="hidden" >

                                    <button  type="button" id="dynamicBtn" class="btn btn-primary btn-sm">确认</button>
                                </form>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>


        <footer class="footer">
            <p class="copyright pull-right">
                &copy; <script>document.write(new Date().getFullYear())</script> Halachat rights reserved
            </p>
        </footer>


    </div>
</div>
</div>
</body>

<!--   Core JS Files   -->
<script src="assets/js/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="assets/js/bootstrap.min.js" type="text/javascript"></script>

<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<script src="https://cdn.staticfile.org/qiniu-js-sdk/1.0.14-beta/qiniu.min.js" type="text/javascript"></script>
<script src="assets/js/plupload.min.js" type="text/javascript"></script>
<script src="assets/js/qiniu.min.js" type="text/javascript"></script>
<script src="https://cdn.staticfile.org/plupload/3.1.0/i18n/ar.js" type="text/javascript"></script>

<script>
    var authorization = "Bearer " + getCookie("token");

    $(function () {
        $.fn.serializeObject = function() {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name]) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };
        getToken();

        

    })

    $("#memberBtn").click(function(){
        var url= imgUrl.substring(0,imgUrl.length-1);
        if (imgUrl==""){
          alert("未上传头像")
        }else{
        $("input[name= 'avatarUrl']").val(url);
            $.ajax({
            url:"/was/member/fack",
            method:"post",
            headers : {
                "Authorization" : authorization,
                "Content-Type" : "application/json"
            },
            data:JSON.stringify($("#memberForm").serializeObject()),
            success:function () {
                imgUrl="";
                $("#memberForm input").val("")
                alert("操作成功！！")
            }
    })}
    })



    $("#dynamicBtn").click(function(){
       var url= imgUrl.substring(0,imgUrl.length-1);
        $("input[name= 'imgUrl']").val(url);
        alert(JSON.stringify($("#dynamicForm").serializeObject()));
        $.ajax({
            url:"/was/dynamic/fack",
            method:"post",
            headers : {
                "Authorization" : authorization,
                "Content-Type" : "application/json"
            },
            data:JSON.stringify($("#dynamicForm").serializeObject()),
            success:function (content) {
                if (content.data!=null){
                    imgUrl = "";
                    alert("创建成功")
                }
            }
        })
    })


    function getToken(){
        $.ajax({
            url : "/util/qtoken",
            method : "GET",
            data: {},
            success: function(content){
                qiniuInit(content.data.member);
            },
            error: function(){
                alert("error, try again...");
            }
        })
    }



    var  imgUrl="";
    function qiniuInit(token){
        uploader = Qiniu.uploader({
            runtimes: 'html5,flash,html4',
            browse_button: 'upload-select',
            uptoken : token,
            get_new_uptoken: false,
            unique_names: false ,
            save_key: false,
            domain: 'member.resources.7halachat.com',
            container: 'upload-area',
            max_file_size: '100mb',
            flash_swf_url: 'flash/Moxie.swf',
            max_retries: 0,
            dragdrop: false,
            drop_element: 'container',
            chunk_size: '4mb',
            auto_start: true,
            filters: {
                mime_types : [
                    { title : "Image files", extensions : "jpg,gif,png"}
                ],
                max_file_size: "4mb",
                prevent_duplicates: true
            },
            init: {
                'FilesAdded': function(up, files) {
                    $("a#preview").addClass("hidden");
                    plupload.each(files, function(file) {
                        // 文件添加进队列后，处理相关的事情
                    });
                },
                'BeforeUpload': function(up, file) {
                    console.log(file);
                },
                'UploadProgress': function(up, file) {
                    // 每个文件上传时，处理相关的事情
                },
                'FileUploaded': function(up, file, info) {
                   // var domain= up.getOption('domain');
                    var res = JSON.parse(info);
                   // var sourceLink ="http://"+ domain +"/"+ res.key;
                    console.log(res.key);
                    imgUrl +=res.key+",";
                    console.log(imgUrl)
                },
                'Error': function(up, err, errTip) {
                    console.log(up);
                    console.log(err);
                    console.log(errTip);
                    alert("上传失败")
                },
                'UploadComplete': function() {
                        alert("上传成功！！")
                },
                'Key': function(up, file) {

                    var name= new Date().getTime()+$("#type").val();
                    var key = name;
                    return key
                }
            }
        });

    }

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }
    
</script>



</html>
